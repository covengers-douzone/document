## 인삿말

(3,2,1) 안녕하십니까 저희는 2조 코벤져스 오픈 채팅 조 입니다. 저는 발표 진행을 맡은 배유진 입니다. 지금부터 2조 발표를 시작하겠습니다.

저희는 크게 피피티 발표, 시연순으로 발표를 진행하겠습니다.

---

PPT 발표를 진행하겠습니다.

목차로는 개발배경, 기능소개 , 기술소개  ,개발 과정 및 발전 방향 순으로 이루어져 있습니다.

---

## 개발 배경

첫번째로 개발배경부터 시작 하겠습니다

현대 사회에서 채팅앱을 사용하는 인원은 얼마만큼일까요? (통계자료 보여줌) 

자료에서 보시듯이 한국인이 연령과 상관없이 가장 많이 사용하는 어플은 카카오톡입니다. 그만큼 채팅 어플은 우리 삶에 자연스레 스며들어 있습니다.

그럼 다양한 사용자들이 사용하고 있는 채팅앱들은 어떤것들이 있을까요? 

wechat, line, kakao, slack ....등 지금도 생겨나고 있는 다양한 채팅 서비스를 포함한다면 수없이 많은 채팅 서비스가 존재할 것입니다. 

이러한 많은 서비스들의 공통점은 UI 및 UX의 직관성으로 인한 사용 편리함과 slack의 경우 코드 공유기능등 사용자들이 필요한 기능을 넣었다는 것입니다.

 이 장점을 살리고자 저희 프로젝트는 어플을 직관적으로 사용자가 사용할 수 있고,  사용해봤던 다양한 채팅 서비스로부터 공통적인 기본 기능을 갖춤과 동시에 각 서비스들의 장점을 취합해서 녹여내자는 취지로 시작하게 되었습니다. 

이 취지를 바탕으로 사용자의 입장에서 서비스에 자연스레 적응할 수 있도록 세밀한 요소들에 중점을 두어 개발하되, 점진적으로 기능을 추가해나갔습니다.

이러한 요소들을 바탕으로 저희가 만든 어플리케이션의 기능을 소개하도록 하겠습니다. 기능 소개는 손재현 조원이 진행하도록 하겠습니다.

---

## **기능 소개**

---

기능소개 발표를 담당한 손재현입니다.

먼저 기능 분류에 대해 말씀드리겠습니다.

저희 조의 기능에는 크게 회원가입 및 로그인, 채팅종류, 채팅 내 기능, 설정이 있습니다.

1. 먼저 회원가입 화면입니다. 회원가입 화면에서 필요한 회원정보를 받고 SMS API를 사용하여서 문자인증을 통해 회원의 유효성 인증을 받습니다.
2. 가입 및 로그인 후 친구 추가를 통하여 친구 추가 및 채팅 생성을 할 수 있습니다.
3. 채팅 생성 후 상대방의 상태정보를 알 수 있습니다. 프로필 화면을 보시면 오프라인일 경우 아무것도 뜨지않고,
온라인일 경우에는 초록불이 뜨며, 현재 접속한 채팅방에서 상대방도 채팅방에 입장시 접속 메시지가 뜨는것을 통해 상태정보를 알 수 있습니다.
4. 채팅 종류에 대해 말씀드리겠습니다. 채팅의 종류에는 1:1 채팅, 그룹 채팅, 오픈 채팅, 비회원 채팅이 있습니다.
채팅의 각 특징에 대해 말씀드리면 1:1 채팅은 친구 추가를 통하여 친구리스트에 있는 유저와 채팅이 가능하며, 그룹채팅은 친구리스트에 있는 유저를 초대하여 그룹으로 채팅이 가능합니다.
오픈채팅은 친구 목록과 상관없이 입장하여 채팅을 할 수 있습니다. 비회원 채팅은 관리자들이 생성한 방에서 회원가입 없이 비회원들만 이용가능한 채팅입니다.
5. 채팅 내의 기능들에 대해 말씀드리겠습니다. 먼저 채팅의 기본적인 기능인 텍스트 채팅입니다.

채팅내의 파일전송 기능들을 말씀드리겠습니다. 화면하단의 버튼을 통해 이모티콘, 코드블럭, 이미지, 비디오를 전송할수 있는 기능이 있습니다.
우측상단의 마크다운 체크박스를 통해서 마크다운 문법을 사용하여 해당 형식의 메세지를 보낼 수 있습니다. 채팅 방 내의 캘린더를 통해 일정을 공유하는 기능이 있습니다.

1. 비회원 채팅의 화면입니다. 비회원 채팅은 회원채팅과 다르게 친구추가, 프로필 변경, 개인방생성의 기능을 제한하여 구성하였습니다.
2. 마지막으로 프로필 설정 기능입니다. 설정 기능에는 프로필 변경, 비밀번호 변경, 회원 탈퇴가 있습니다.

[https://www.sciencetimes.co.kr/news/sns의-진화-소통에서-플랫폼으로/](https://www.sciencetimes.co.kr/news/sns%EC%9D%98-%EC%A7%84%ED%99%94-%EC%86%8C%ED%86%B5%EC%97%90%EC%84%9C-%ED%94%8C%EB%9E%AB%ED%8F%BC%EC%9C%BC%EB%A1%9C/)

위의 통계자료를 합친 것보다 많은 다수가 채팅 서비스를 사용 중.

---

## 기술 소개

안녕하십니까. 기술 파트 진행을 맡은 발표자 강우성입니다. 발표 시작하겠습니다. 

먼저 전체적인 아키텍처를 보여드리겠습니다. 구성은 크게 front와 back, 그리고  그 외의 스택들로 나누어져있습니다. 기술들에 대한 간단한 소개와 기술을 선택한 이유에 대해 핵심부분을 추려 말씀드리도록하겠습니다.

// 기술 선택의 이유와 설계 목적에 대해 간략하게 말씀드리겠습니다

 // 저희는 크게 2개의 API서버와 하나의 프론트 그리고 DB로 나누어져 있습니다.

먼저, Front 부분입니다. React를 선택한 이유에는 크게 2가지가 있습니다. 첫째, 채팅 서비스의 특성상 잦은 인터랙션이 발생하게 되고, React에서는 DOM에 직접 접근하여 변화를 반영하는 것이 아닌, 가상 DOM을 활용하여 필요한 곳만 부분적으로 랜더링하기 때문에 DOM의 조작을 최소화하여 성능적으로 더욱 우월한 이점을 가질 수 있다고 판단했기 때문입니다. 둘째, React에는 활용 가능한 다양한 라이브러리가 존재하기 때문에 이를 활용하기 위해 선택하였습니다.

다음으로 Backend 부분입니다. 이번 프로젝트에서 저흰 API 서버를 두 개로 나누어 사용하였습니다. 로그인, 암호화, 회원가입 등과 관련된 전반적인 API를 담당하는 Spring과 채팅 관련 핵심 API를 담당하는 Node 서버입니다.  이는 큰 부분의 쓰임새를 나누어 API서버의 재사용과 확장에 용이하도록 설계하였습니다. 

(*학습적인 의의를 포함하여 다양한 환경에서 프로젝트를 진행하고자 서버를 나누어 활용/확장성(api기능에 따른 분류)

두 서버와 Front간의 통신은 JWT 토큰을 사용합니다. 저흰 차후 서버의 확장과 앱 개발 또한 염두에 두었기 때문에 토큰을 사용하여 확장성에서의 이점을 가지려 선택하게 되었습니다. 

토큰의 발급과 검증 로직은 다음과 같습니다. 사용자가 로그인을 시도하게되면 Spring의 필터에서 사용자를 확인후 토큰을 발급하여 응답하게 됩니다. 사용자 측에서는 이 토큰을 Node로 api 요청시에 함께 보내게 되고, Node 측에서는 토큰의 검증 후 요청된 데이터를 응답하게 됩니다. 

(*JWT는 발급한 후 검증만 하면 되기 때문에 추가 저장소가 필요 없습니다.서버를 확장하거나 유지,보수하는데 유리,확장성)

 // Redis는 메시지 중개자로서 역할을 할 수 있는데, 이를 Redis pub sub이라 합니다.

// Publisher는 구독하는 Subscriber가 없는 경우에도 채널에 메시지를 보낼 수 있지만, 그 메시지는 삭제됩니다.

// 이 방식은 빠른 처리가 가능하다는 것이 장점입니다.

채팅 서비스의 전반적인 API를 담당하고 있는 Node에서는 채팅 서비스의 구현을 위해 socke.io와 redis의 pub/sub 패턴을 사용하였습니다.

  @ @여기서 redis는 메세지 중개자로써의 역할로 publisher 라고하는 메시지 발신자가 어떤 구독자가 있는지 알지 못해도 채널을 통해 구독자 라고하는 수신자 에게 메시지를 게시 할 수 있습니다. 

publisher을 통해 메세지를  발송하면 구독자는 구독하는 채널에 따라 메세지를 선택적으로 수신하게 됩니다. 이와 같은 구조와 그 외 redis의 특징들은 보다 빠르게 메세지를 처리할 수 있을거라는 판단하에Redis를 적용하였습니다. 

(현재에는 단일 채팅 서버로 운영되고 있지만, 차후에)

추가적으로 서비스가 커짐에 따라 채팅 서버의 수가 늘어나게 되었을때, 하나의 채팅방에 서로 다른 서버의 소켓으로 연결된 사용자가 있을 경우 기존의 socket으로는 사용자간의 메세지 통신을 할 수 없지만, 하나의 sub로 묶음으로써 서로 다른 인스턴스로 연결됐다 할지라도 메세지 교환을 원활하게 할 수 있다는 장점이 있습니다. 

이 WebSocket 연결은 매체가 사용자간에 채팅 메시지를 브로드 캐스트 할 수 있도록하는 기능입니다. 이제 새 사용자가 들어 오면 새 인스턴스에 연결될 수 있습니다. 따라서 서로 다른 사용자 (따라서 각각의 WebSocket 연결)가 서로 다른 인스턴스와 연결되는 시나리오가 있습니다. 결과적으로 그들은 서로 메시지를 교환 할 수 없습니다.이것은 우리의 장난감 채팅 응용 프로그램에서도 받아 들일 수 없습니다. 따라서 Redis Pub / Sub 이벤트를 사용하여 이러한 작업이 원활하게 실행되도록해야합니다.

메시지 전송 →  DB 저장 → pub을 통해 해당 방에 속하는 참가자들을 찾음(방이 생성되면 소켓이 생성되고 레디스도 생성되고 구독도 함께 한다.) → 참가자들을 찾으면 이 정보를 바탕으로 소켓 emit → 클라이언트들은

다음으로 엘라스틱 서치의 사용 부분입니다.

엘라스틱 서치를 logstash를 통해 mysql에 연결하여 원하는 데이터 셋을 가져올 수 있게 하였습니다. 이 과정에서 쿼리를 이용해 비속어와 관련된 데이터 메세지를 가져와 이를 엘라스틱 서치에 전달하고, 이 전달된 데이터를 kibana를 통해 시각화아여 데이터의 확인 및 가공이 가능하게 하였습니다. 

이를 통해 저흰 채팅방의 메세지를 수집하고, 이를 분석하여 각 방의 비속어 사용에 대한 통계치 분석 및 이를 통한 비속어의 필터 처리에 활용하기 위해 사용하였습니다.

그 외에 사용된 대표적인 기술로는 빌드 툴로는 Maven, 배포는 Amazone EC2를 활용하였고, 문서 정리와 협업 도구로는 Notion과 Swagger를, 테스트 도구로는 Postman을 사용하였습니다. 전체적인 형상 관리는 git의 브랜치를 활용해 협업을 더욱 원활하게 진행할수 있도록 하였습니다. 

이로써 기술 파트 발표를 마치겠습니다. 감사합니다. 

엘라스틱 서치, mysql에 연결. logstash를 통해 mysql에(JDBC input plugin을 통해서 연결했고. logstash) 원하는 데이터 셋을 가져온다. 이 과정에서 원하는 데이터를 가져오는 과정은 쿼리 혹은 필터(조건문) ⇒ 이 추출된 데이터를. 가져온 데이터를 엘라스틱 서치에 전달. 이 전달된 데이터를 kibana를 통해 시각화. 이 시각화된 정보를 통해 데이터를 확인 및 가공이 가능하다. 

현재, 특정 비속어를 사용한 참가자의 번호와 방 번호에 대한 정보 및 통계치를 얻어낼 수 있다. 

전반적인 협업 도구로는, Notion을, API문서 정리 툴로는 Swagger를, 마지막으로 CVM으로는 github을 사용.

이를 통해 자주 사용된 데이터 등 통계치를 얻어낼 수 있다. 

---

## 개발 방향 및 발전 방향

PPT 발표 마지막으로 개발 과정 및 발전 방향에 대해 소개해드리도록 하겠습니다.

저희는 이렇게 총 5단계로 개발을 진행하였습니다. 스토리 보드로 전체적인 서비스의 방향을 짜고, 서비스 방향에 따라 DB 설계를 한 후, 본격적으로 어플리케이션 개발을 진행하였습니다. 그 후, 배포 및 문서화를 진행하였습니다.

이 화면은 서비스 초반 설계도입니다. 이러한 기능들을 염두해 두고, 개발을 진행하였습니다. 

다음은 설계한 ERD 화면입니다.

아마존에 배포한 모습입니다. spring, node, react, redis, mysql 서버를 각각 만들어 배포하였습니다.

node와 spring 각각의 API 기능을 명세한 swagger 적용 모습입니다.

다음은 협업을 위해 Notion을 통하여 각 작업별로 정리한 화면입니다. Notion을 통하여 server의 주소와 버그 이슈들을 팀원들끼리 공유하였습니다.

깃헙 레파지토리입니다. 서비스관련 레파지토리는 상단에 node, react, spring으로 나뉘어져 있고, 프로젝트 관련 연습이 필요한 경우, 관련 레파지토리를 만들어 사용하였습니다.

마지막으로 서비스의 가능한 발전 방향에 대해 소개해드리고 PPT발표를 마치도록 하겠습니다.

저희 어플리케이션은 첫 번째로 모바일 어플리케이션 개발이 용이하다는 장점이 있습니다. React로 개발하였기에 유사한 React Native로 전환이 쉽습니다. 또한, JWT 토큰과 두 개의 API 서버를 사용하여 큰 로직의 수정없이 코드의 재사용이 가능합니다.

- JWT 재사용성
    - server에서 client로 데이터 전달 시 전달 방식으로 session 과 token 두 방식이 있습니다. 웹의 경우 cookie에 session을 저장하여 전달하지만, 모바일 환경의 경우 session을 전달할 수 있는 cookie가 없는 것으로 알고 있습니다. JWT는 cookie와 상관없이 전달할 수 있어 모바일로의 확장성이 있습니다.
    

다음으로는 엘라스틱 서치 기능을 확장할 수 있다는 것입니다. 필터링이 되는 현재 엘라스틱 기능을 조금 더 발전시켜 채팅 제재 및 분석을 자동으로 적용되도록 할 수 있습니다.

- 어떻게 자동으로 적용?
    - ELK를 클라우드 서버에 배포를 한 후 항상 서버를 켠 상태에서 logstash 를 통하여 비속어를 필터링 한 정보들을 데이터베이스에서 트랜잭션을 만들어서 해당 사용자의 채팅제제를 가하도록 생각하였습니다.
- 원래의 elastic 경우는 흔히 빠른 검색엔진으로 사용을 많이 한다고 알고있습니다. 하지만 저희 조의 경우에는 먼저 JSX를 사용하여 자바스크립트 코드로 필터를 적용하여 채팅방 및 친구 검색을 사용하였는데 현재의 서비스에서 큰 문제가 발생하지 않았습니다. 그렇기 때문에 JSX로 현재 검색을 사용하였고, elastic을 어떤식으로 사용해보면 좋을지 찾아보다가 logstash를 사용하여 필터링을 통해 원하는 정보를 필터링하는 기능으로 사용하면 좋을것같다는 의견이 있어서 필터적용에 사용하게 되었습니다.

마지막으로 여러 서비스 기능의 추가관련 확장성입니다. React 는 서비스 추가시 별다른 페이지 생성 없이 해당하는 Component만 추가적으로 생성하면 되는 특징이 있습니다. 이러한 React의 특징과,  JPA 및 Sequelize등의 ORM 특성상 음성 메세지 및 게시판, 챗봇등의 기능을 현재 개발된 어플리케이션에 추가적으로  넣을 수 있습니다. 

- react : 여러 라이브러리 사용, component 식의 구성, 중간에 코드를 넣을 필요 없이 새로운 컴포넌트를 생성하기만 하면 로직의 변경 없이 쉽게 기능을 추가 할 수 있습니다.
- ORM 사용(Spring : JPA, Node: Sequelize)
    - 다른 테이블이 생성되거나 테이블 내 컬럼 변경이 있는 경우, 별도로 기존의 sql을 수정할 필요가 없다.

이상으로 PPT 발표를 마치도록 하겠습니다. 

이어서 발표 시연을 시작하도록 하겠습니다. 

발표 시연은 박대헌 조원이 진행하도록 하겠습니다.

— 시연 끝나고 시간이 거의 다 된 경우

— 시연 끝나고 시간이 충분한 경우

이상으로 발표 및 시연을 마치도록 하겠습니다. 들어주셔서 감사합니다. 마지막 순차로 Q&A를 진행하겠습니다. 질문이 있으시다면 편하게 해주시면 감사합니다. 

질문이 없으신 경우 이만 2조 코벤져스 오픈채팅조 발표를 마치도록 하겠습니다. 

---

## 시연

시연을 맡게된 박대헌 이라고 합니다

주소창에 저희 웹 홈페이지로 가게 된다면 , 로그인 ID/PW 찾기 , 비회원 로그인 , 회원가입으로 나누어져 있습니다

먼저 회원가입 부터 보여드리겠습니다

회원가입을 할때  이메일 과 핸드폰 번호는 중복 할 수 없으며 저희는 문자 인증메세지를 통해 회원가입이 되어집니다 ~ 

번호를 입력을하고 문자 인증 메시지를 받아보도록 하겠습니다

인증번호가 도착하였고 입력해보도록 하겠습니다

로그인을 누르면 나오는 첫 화면 입니다

좌측에 보시는 사이드 바를 보시면 첫번째 아이콘은 현재 자신이 참여한 채팅방 목록을 보여주며

두번째 아이콘은 친구 목록 , 세번째 아이콘은 오픈채팅방  좌측 하단을 보시면 설정 , 로그아웃 으로 

이루어져 있습니다.

설정 파일에서 먼저 프로필 부터 변경 하겠습니다

친구 목록부터 들어가서  1 : 1 채팅부터 보여드리겠습니다

친구 목록을 간략히 설명하자면 위쪽에 있는 목록은 내가 친구를 추가한 목록이고 밑 쪽에 있는 목록을 저를 친구 추가 하고 있는 목록 입니다.

친구를 먼저 추가 해보고 상대방에 친구 목록을 한번 보겠습니다.

상대방도 친구 추가가 되어 있고 상대방도 저를 친구를 추가 해보겠습니다.

친구추가가 되었고 채팅방 생성을 누르면 1:1 채팅방이 입력 되어집니다

현재 좌측에 보시면 채팅 방이 생성되어졌습니다.  그 채팅 방의 프로필을 눌러 보시면 그 사람의 정보가 보이게 되어집니다. 

채팅방 을 삭제를 하게 되면 자신의 채팅방은 나가지지만 상대방에서는 알 수 없는 상태로 보여지게 됩니다.

이제 채팅을 쳐보겠습니다. (양 측 화면 뛰우고)

채팅의 오른쪽 마우스를 누르면 메시지가 삭제가 되어지는데 상대 측 메시지는 삭제가 되지 않습니다. 그리고 채팅 안의 내역을 검색하고 싶으면 채팅 검색 창에 입력을 하고 스크롤을 올리게 된다면 이전 메시지를 불러 오는 형식입니다.

그 외의 기능으로  파일을 보내고 , 다운을 받을 수 있으며 비디오도 보내고 받을 수 있습니다

코드 블럭도 같이 보낼 수 있습니다 JSX 파일로 코드를 보내게 된다면 현재 메시지에 코드 블럭이 보여지게 됩니다. 

우측 상단에 버튼을 누르시면 방 정보를 볼 수 있는데 1:1 채팅 방인 경우에는 초대를 할 수 있거나 추방을 할 수 없습니다.

그 외의 기능으로  그 밑에있는 아이콘을 누르게 된다면 보낸 이미지 파일들을 볼 수 있습니다.

다음은 그룹 채팅 보여 드리겠습니다.

그룹 채팅은 친구 목록에 있는 다수의 인원들을 초대를 할 수 있으며 총 3명 이상 되어야 그룹 채팅을 할 수 있습니다.

그룹 채팅 방의 특징은 방을 만든 사람이 추방을 할 수 있으며 그룹 방에 있는 인원들은 자신의 친구들을 초대 할 수 있습니다

그룹 채팅 방에서 호스트가 방을 삭제 해버리면 방은 존재하지만 알 수 없는 유저가 되어버립니다.

사이드 바에 있는 좌측에 있는 오픈 채팅 보여 드리겠습니다

오픈 채팅은 비회원을 제외한 회원들에게 모두 보여지는 채팅 방 입니다. 오픈 채팅 방에 검색하시면 원하는 방을 찾을 수 있습니다.  방을 먼저 만들어 보겠습니다.  오픈 채팅 방의 타입은 2가지 인데 비밀번호가 걸린 방 , 아닌 방으로 나눠 져있고 분홍색으로 표시 된 방은 비밀번호가 있는 방입니다.

디폴트로 방을 생성하고 들어 가보겠습니다.

오픈 채팅 방도 그룹 채팅 방과 비슷하게 방 추방 , 방 초대 기능이 가능합니다. 

오픈 채팅 방의 호스트가 방을 삭제 하게 된다면 해당 방은 존재 하지 않게 됩니다.

설정 기능 보여드리겠습니다

설정 파일에서는 개인 정보를 수정 할 수 있으며 회원 탈퇴를 할 수 있습니다.

회원을 탈퇴 해보겠습니다.

회원을 탈퇴한 유저는 로그인을 다시 하게 된다면 3개월 이내라면 데이터를 다시 복구 할 수 있습니다 하지만 채팅 방들은 삭제가 되거나 알 수 없는 방으로 변경 되어집니다.

마지막으로 비 회원으로 접속 해보겠습니다

비회원들은 비회원들만의 전용 채팅 방이 존재 하게 되어지고 일반 회원과 다르게 채팅 방의 일부 기능들 ,  친구 추가 , 방 생성이 제한 되어집니다. 

또한 자신의 메세지를 읽었는지 안 읽었는지 표시도 되지 않으며 회원과 다르게 접속이 끊기거나 로그아웃을 누르게 되면 즉시 데이터가 삭제됩니다.

이상입니다
